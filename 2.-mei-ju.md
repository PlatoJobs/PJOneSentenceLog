# 2.枚举

本篇文章将讲述Swift中很常用的也很重要的一个知识点 👉 `Enum枚举`。首先会介绍与OC中枚举的差别，接着会从底层分析`Enum`的使用场景，包含枚举的`嵌套`和`递归`，`与OC的混编`的场景，最后分析枚举的`内存大小`的计算方式，希望大家能够掌握。

### 一、OC&Swift枚举的区别

#### 1.1 OC中的NS\_ENUM

OC中的枚举和C/C++中的枚举基本一样，具有以下特点👇

* 仅支持`Int类型`，默认`首元素值为0`，后续元素值`依次+1`
* `中间的元素`有赋值，那么`以此赋值为准`，后续`没赋值`的元素值依旧`依次+1` 枚举使用示例代码👇

```text
typedef NS_ENUM(NSInteger, WEEK) {
    Mon,
    Tue = 10,
    Wed,
    Thu,
    Fri,
    Sat,
    Sun
};
// 调用代码👇
WEEK a = Mon; 
WEEK b = Tue;
NSLog(@"a = %d, b = %d", (int)a, (int)b);
```

#### 1.2 Swift中的Enum

Swift中的枚举比OC的`强大很多`！其特点如下👇

* 格式： 不用逗号分隔，类型需使用case声明
* 内容：
  1. 支持`Int、Double、String`等`基础类型`，也有`默认枚举值`（`String类型`默认枚举值为`key的名称`，`Int、Double`数值型默认枚举值为`0`开始`+1递增`
  2. 支持`自定义选项` 👉 `不指定`支持`类型`，就`没有rawValue`，但同样`支持case枚举`，可`自定义关联内容`

> 注意：`rawValue`在后面`枚举的访问`中会详细的讲解。

示例代码👇

```text
// 写法一
// 不需要逗号隔开
enum Weak1 {
    case MON
    case TUE
    case WED
    case THU
    case FRI
    case SAT
    case SUN
}

// 写法二
// 也可以直接一个case，然后使用逗号隔开
enum Weak2 {
    case MON, TUE, WED, THU, FRI, SAT, SUN
}

// 定义一个枚举变量
var w: Weak1 = .MON
```

**1.2.2 自定义选项类型**

如果在声明枚举时`不指定类型`，那么可给枚举项添加`拓展内容`\(即`自定义类型`\)。`switch-case`访问时，可取出拓展类型进行相应的操作。例如👇

```text
// 自定义类型的使用
enum Shape {
    case square(width: Double)
    case circle(radius: Double, borderWidth:Double)
}

func printValue(_ v: Shape) {
    // switch区分case(不想每个case处理，可使用default)
    switch v {
    case .square(let width):
        print(width)
    case .circle(let radius, _):
        print(radius)
    }
}

let s = Shape.square(width: 10)
let c = Shape.circle(radius: 20, borderWidth: 1)
printValue(s)
printValue(c)
```

![](.gitbook/assets/image%20%2830%29.png)

### 二、Swift枚举的使用

接下来我们看看Swift枚举的使用，包含一些特殊的场景的情况。

#### 2.1 枚举的访问

说到枚举的访问，就必须得提一个关键字`rawValue`，使用案例👇

```text
enum Weak: String{
    case MON, TUE, WED, THU, FRI, SAT, SUN
}
var w = Weak.MON.rawValue
print(w)
```

运行结果👇

![](.gitbook/assets/image%20%2823%29.png)

> 注意：如果enum`没有声明类型`，是`没有rawValue`属性的👇

![](.gitbook/assets/image%20%2829%29.png)

现在问题来了 👉 `rawValue`对应在底层是如何做到读取到`MON`值的？

**rawValue的取值流程**

老规矩，找入口，之前我们都是查看SIL，当然这里也不例外👇

`swiftc -emit-sil xx.swift | xcrun swift-demangle >> ./xx.sil && vscode xx.sil`

先看看枚举Week👇

![](.gitbook/assets/image%20%2828%29.png)

接着看看main函数的流程👇

![](.gitbook/assets/image%20%2825%29.png)

最后看看rawValue的getter方法👇

![](.gitbook/assets/image%20%2821%29.png)

然后看bb8代码段👇

![](.gitbook/assets/image%20%2824%29.png)

至此，我们现在知道了，`rawValue`的底层就是调用的`getter方法`，getter方法中`构造了字符串`，但是这个`字符串的值`（例如“MON”）从`哪里取出`的呢？其实我们能猜出来，应该是在`编译期确定`了的，所以，我们打开工程的exec可执行文件，查看`Mach-O`👇  
  


![](.gitbook/assets/image%20%2822%29.png)

