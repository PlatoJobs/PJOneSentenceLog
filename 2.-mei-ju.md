# 2.æšä¸¾

æœ¬ç¯‡æ–‡ç« å°†è®²è¿°Swiftä¸­å¾ˆå¸¸ç”¨çš„ä¹Ÿå¾ˆé‡è¦çš„ä¸€ä¸ªçŸ¥è¯†ç‚¹ ğŸ‘‰ `Enumæšä¸¾`ã€‚é¦–å…ˆä¼šä»‹ç»ä¸OCä¸­æšä¸¾çš„å·®åˆ«ï¼Œæ¥ç€ä¼šä»åº•å±‚åˆ†æ`Enum`çš„ä½¿ç”¨åœºæ™¯ï¼ŒåŒ…å«æšä¸¾çš„`åµŒå¥—`å’Œ`é€’å½’`ï¼Œ`ä¸OCçš„æ··ç¼–`çš„åœºæ™¯ï¼Œæœ€ååˆ†ææšä¸¾çš„`å†…å­˜å¤§å°`çš„è®¡ç®—æ–¹å¼ï¼Œå¸Œæœ›å¤§å®¶èƒ½å¤ŸæŒæ¡ã€‚

### ä¸€ã€OC&Swiftæšä¸¾çš„åŒºåˆ«

#### 1.1 OCä¸­çš„NS\_ENUM

OCä¸­çš„æšä¸¾å’ŒC/C++ä¸­çš„æšä¸¾åŸºæœ¬ä¸€æ ·ï¼Œå…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ğŸ‘‡

* ä»…æ”¯æŒ`Intç±»å‹`ï¼Œé»˜è®¤`é¦–å…ƒç´ å€¼ä¸º0`ï¼Œåç»­å…ƒç´ å€¼`ä¾æ¬¡+1`
* `ä¸­é—´çš„å…ƒç´ `æœ‰èµ‹å€¼ï¼Œé‚£ä¹ˆ`ä»¥æ­¤èµ‹å€¼ä¸ºå‡†`ï¼Œåç»­`æ²¡èµ‹å€¼`çš„å…ƒç´ å€¼ä¾æ—§`ä¾æ¬¡+1` æšä¸¾ä½¿ç”¨ç¤ºä¾‹ä»£ç ğŸ‘‡

```text
typedef NS_ENUM(NSInteger, WEEK) {
    Mon,
    Tue = 10,
    Wed,
    Thu,
    Fri,
    Sat,
    Sun
};
// è°ƒç”¨ä»£ç ğŸ‘‡
WEEK a = Mon; 
WEEK b = Tue;
NSLog(@"a = %d, b = %d", (int)a, (int)b);
```

#### 1.2 Swiftä¸­çš„Enum

Swiftä¸­çš„æšä¸¾æ¯”OCçš„`å¼ºå¤§å¾ˆå¤š`ï¼å…¶ç‰¹ç‚¹å¦‚ä¸‹ğŸ‘‡

* æ ¼å¼ï¼š ä¸ç”¨é€—å·åˆ†éš”ï¼Œç±»å‹éœ€ä½¿ç”¨caseå£°æ˜
* å†…å®¹ï¼š
  1. æ”¯æŒ`Intã€Doubleã€String`ç­‰`åŸºç¡€ç±»å‹`ï¼Œä¹Ÿæœ‰`é»˜è®¤æšä¸¾å€¼`ï¼ˆ`Stringç±»å‹`é»˜è®¤æšä¸¾å€¼ä¸º`keyçš„åç§°`ï¼Œ`Intã€Double`æ•°å€¼å‹é»˜è®¤æšä¸¾å€¼ä¸º`0`å¼€å§‹`+1é€’å¢`
  2. æ”¯æŒ`è‡ªå®šä¹‰é€‰é¡¹` ğŸ‘‰ `ä¸æŒ‡å®š`æ”¯æŒ`ç±»å‹`ï¼Œå°±`æ²¡æœ‰rawValue`ï¼Œä½†åŒæ ·`æ”¯æŒcaseæšä¸¾`ï¼Œå¯`è‡ªå®šä¹‰å…³è”å†…å®¹`

> æ³¨æ„ï¼š`rawValue`åœ¨åé¢`æšä¸¾çš„è®¿é—®`ä¸­ä¼šè¯¦ç»†çš„è®²è§£ã€‚

ç¤ºä¾‹ä»£ç ğŸ‘‡

```text
// å†™æ³•ä¸€
// ä¸éœ€è¦é€—å·éš”å¼€
enum Weak1 {
    case MON
    case TUE
    case WED
    case THU
    case FRI
    case SAT
    case SUN
}

// å†™æ³•äºŒ
// ä¹Ÿå¯ä»¥ç›´æ¥ä¸€ä¸ªcaseï¼Œç„¶åä½¿ç”¨é€—å·éš”å¼€
enum Weak2 {
    case MON, TUE, WED, THU, FRI, SAT, SUN
}

// å®šä¹‰ä¸€ä¸ªæšä¸¾å˜é‡
var w: Weak1 = .MON
```

**1.2.2 è‡ªå®šä¹‰é€‰é¡¹ç±»å‹**

å¦‚æœåœ¨å£°æ˜æšä¸¾æ—¶`ä¸æŒ‡å®šç±»å‹`ï¼Œé‚£ä¹ˆå¯ç»™æšä¸¾é¡¹æ·»åŠ `æ‹“å±•å†…å®¹`\(å³`è‡ªå®šä¹‰ç±»å‹`\)ã€‚`switch-case`è®¿é—®æ—¶ï¼Œå¯å–å‡ºæ‹“å±•ç±»å‹è¿›è¡Œç›¸åº”çš„æ“ä½œã€‚ä¾‹å¦‚ğŸ‘‡

```text
// è‡ªå®šä¹‰ç±»å‹çš„ä½¿ç”¨
enum Shape {
    case square(width: Double)
    case circle(radius: Double, borderWidth:Double)
}

func printValue(_ v: Shape) {
    // switchåŒºåˆ†case(ä¸æƒ³æ¯ä¸ªcaseå¤„ç†ï¼Œå¯ä½¿ç”¨default)
    switch v {
    case .square(let width):
        print(width)
    case .circle(let radius, _):
        print(radius)
    }
}

let s = Shape.square(width: 10)
let c = Shape.circle(radius: 20, borderWidth: 1)
printValue(s)
printValue(c)
```

![](.gitbook/assets/image%20%2858%29.png)

### äºŒã€Swiftæšä¸¾çš„ä½¿ç”¨

æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹çœ‹Swiftæšä¸¾çš„ä½¿ç”¨ï¼ŒåŒ…å«ä¸€äº›ç‰¹æ®Šçš„åœºæ™¯çš„æƒ…å†µã€‚

#### 2.1 æšä¸¾çš„è®¿é—®

è¯´åˆ°æšä¸¾çš„è®¿é—®ï¼Œå°±å¿…é¡»å¾—æä¸€ä¸ªå…³é”®å­—`rawValue`ï¼Œä½¿ç”¨æ¡ˆä¾‹ğŸ‘‡

```text
enum Weak: String{
    case MON, TUE, WED, THU, FRI, SAT, SUN
}
var w = Weak.MON.rawValue
print(w)
```

è¿è¡Œç»“æœğŸ‘‡

![](.gitbook/assets/image%20%2832%29.png)

> æ³¨æ„ï¼šå¦‚æœenum`æ²¡æœ‰å£°æ˜ç±»å‹`ï¼Œæ˜¯`æ²¡æœ‰rawValue`å±æ€§çš„ğŸ‘‡

![](.gitbook/assets/image%20%2849%29.png)

ç°åœ¨é—®é¢˜æ¥äº† ğŸ‘‰ `rawValue`å¯¹åº”åœ¨åº•å±‚æ˜¯å¦‚ä½•åšåˆ°è¯»å–åˆ°`MON`å€¼çš„ï¼Ÿ

**rawValueçš„å–å€¼æµç¨‹**

è€è§„çŸ©ï¼Œæ‰¾å…¥å£ï¼Œä¹‹å‰æˆ‘ä»¬éƒ½æ˜¯æŸ¥çœ‹SILï¼Œå½“ç„¶è¿™é‡Œä¹Ÿä¸ä¾‹å¤–ğŸ‘‡

`swiftc -emit-sil xx.swift | xcrun swift-demangle >> ./xx.sil && vscode xx.sil`

å…ˆçœ‹çœ‹æšä¸¾WeekğŸ‘‡

![](.gitbook/assets/image%20%2846%29.png)

æ¥ç€çœ‹çœ‹mainå‡½æ•°çš„æµç¨‹ğŸ‘‡

![](.gitbook/assets/image%20%2837%29.png)

æœ€åçœ‹çœ‹rawValueçš„getteræ–¹æ³•ğŸ‘‡

![](.gitbook/assets/image%20%2821%29.png)

ç„¶åçœ‹bb8ä»£ç æ®µğŸ‘‡

![](.gitbook/assets/image%20%2834%29.png)

è‡³æ­¤ï¼Œæˆ‘ä»¬ç°åœ¨çŸ¥é“äº†ï¼Œ`rawValue`çš„åº•å±‚å°±æ˜¯è°ƒç”¨çš„`getteræ–¹æ³•`ï¼Œgetteræ–¹æ³•ä¸­`æ„é€ äº†å­—ç¬¦ä¸²`ï¼Œä½†æ˜¯è¿™ä¸ª`å­—ç¬¦ä¸²çš„å€¼`ï¼ˆä¾‹å¦‚â€œMONâ€ï¼‰ä»`å“ªé‡Œå–å‡º`çš„å‘¢ï¼Ÿå…¶å®æˆ‘ä»¬èƒ½çŒœå‡ºæ¥ï¼Œåº”è¯¥æ˜¯åœ¨`ç¼–è¯‘æœŸç¡®å®š`äº†çš„ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬æ‰“å¼€å·¥ç¨‹çš„execå¯æ‰§è¡Œæ–‡ä»¶ï¼ŒæŸ¥çœ‹`Mach-O`ğŸ‘‡  
  


![](.gitbook/assets/image%20%2827%29.png)

å¯è§ï¼Œåœ¨`__TEXT, __cstring`çš„sectionæ®µï¼Œè¿™äº›å­—ç¬¦ä¸²åœ¨ç¼–è¯‘æœŸå·²ç»å­˜å‚¨å¥½äº†ï¼Œè€Œä¸”`å†…å­˜åœ°å€æ˜¯è¿ç»­çš„`ã€‚æ‰€ä»¥ï¼Œ`rawValue`çš„getteræ–¹æ³• ğŸ‘‰ caseåˆ†æ”¯ä¸­æ„å»ºçš„å­—ç¬¦ä¸²ï¼Œä¸»è¦æ˜¯åœ¨`Mach-O`æ–‡ä»¶ä¸­ä»`å¯¹åº”åœ°å€`å–å‡ºçš„å­—ç¬¦ä¸²ï¼Œç„¶åå†è¿”å›ç»™`å˜é‡w`ã€‚

**caseå€¼ & rawValueå€¼**

ç°åœ¨æˆ‘ä»¬å¼„æ¸…æ¥šäº†`rawValue`å€¼çš„æ¥æºï¼Œé‚£ä¹ˆåˆæœ‰ä¸€ä¸ªé—®é¢˜ï¼šæšä¸¾`case`å€¼å’Œ `rawValue`å€¼å¦‚ä½•`åŒºåˆ†`å‘¢ï¼Ÿä¸‹é¢çš„ä»£ç è¾“å‡ºæ‰“å°ç»“æœæ˜¯ä»€ä¹ˆï¼Ÿ

```text
//è¾“å‡º caseå€¼
print(Weak.MON)
//è¾“å‡º rawValueå€¼
print(Weak.MON.rawValue)
```

![](.gitbook/assets/image%20%2857%29.png)

è™½ç„¶è¾“å‡ºçš„éƒ½æ˜¯`MON`ï¼Œä½†å…¶å®å¹¶ä¸æ˜¯ç›¸åŒçš„ï¼Œwhyï¼Ÿçœ‹ä¸‹å›¾ğŸ‘‡  
  


![](.gitbook/assets/image%20%2840%29.png)

ä¸Šå›¾å¯çŸ¥ï¼Œå¹¶ä¸èƒ½å°†`æšä¸¾çš„caseå€¼`èµ‹ç»™`å­—ç¬¦ä¸²ç±»å‹å¸¸é‡w`ï¼ŒåŒæ—¶ï¼Œä¹Ÿä¸èƒ½å°†`å­—ç¬¦ä¸²"MON"`èµ‹ç»™`æšä¸¾å€¼t`ã€‚

#### 2.2 æšä¸¾åˆå§‹åŒ–init

åœ¨OCä¸­ï¼Œæšä¸¾æ²¡æœ‰åˆå§‹åŒ–ä¸€è¯´ï¼Œè€Œåœ¨Swiftä¸­ï¼Œæšä¸¾æ˜¯æœ‰`initåˆå§‹åŒ–æ–¹æ³•`ğŸ‘‡  


```text
Weak.init(rawValue:)
```

  
æ¥ä¸‹æ¥æˆ‘ä»¬æ¥çœ‹çœ‹è¿™ä¸ªåˆå§‹åŒ–æ–¹æ³•åœ¨`åº•å±‚çš„æµç¨‹`ï¼Œé¦–å…ˆæ·»åŠ ä»£ç ğŸ‘‡ï¼Œæ‰“ä¸Šæ–­ç‚¹



```text
print(Weak.init(rawValue: "MON")!)
```

æ‰“å¼€æ±‡ç¼–ï¼Œè¿è¡ŒğŸ‘‡

![](.gitbook/assets/image%20%2852%29.png)

![](.gitbook/assets/image%20%2841%29.png)

![](.gitbook/assets/image%20%2855%29.png)

æ¥ç€æˆ‘ä»¬è¿˜æ˜¯çœ‹SILä»£ç ï¼Œå…³äº`Weak.init(rawValue:)`éƒ¨åˆ†ğŸ‘‡

![](.gitbook/assets/image%20%2833%29.png)

![](.gitbook/assets/image%20%2856%29.png)

å…¶ä¸­ï¼Œä¸Šå›¾ä¸­æ¶‰åŠçš„SILçš„æŒ‡ä»¤é‡Šä¹‰ğŸ‘‡

| æŒ‡ä»¤åç§° | æŒ‡ä»¤é‡Šä¹‰ |
| :--- | :--- |
| index\_addr | è·å–å½“å‰æ•°ç»„ä¸­çš„`ç¬¬nä¸ªå…ƒç´ å€¼`çš„åœ°å€\(å³`æŒ‡é’ˆ`\)ï¼Œå­˜å‚¨åˆ°å½“å‰åœ°å€ä¸­ |
| struct\_extract | è¡¨ç¤ºåœ¨ç»“æ„ä½“ä¸­`å–å‡ºå½“å‰çš„Intå€¼`ï¼ŒIntç±»å‹åœ¨ç³»ç»Ÿä¸­ä¹Ÿæ˜¯ç»“æ„ä½“ |
| cond\_br | è¡¨ç¤º`æ¯”è¾ƒçš„è¡¨è¾¾å¼`ï¼Œå³`åˆ†æ”¯æ¡ä»¶è·³è½¬`\(ç±»ä¼¼äºä¸‰å…ƒè¡¨è¾¾å¼\) |

æ¥ç€æ¥çœ‹çœ‹è¿™ä¸ªå…³é”®çš„å‡½æ•°`_findStringSwitchCase`çš„æºç ğŸ‘‡

![](.gitbook/assets/image%20%2822%29.png)

æˆ‘ä»¬ç»§ç»­çœ‹`Weak.init`çš„æœ€ç»ˆå¤„ç†ä»£ç  ğŸ‘‰ `bb29`ä»£ç æ®µğŸ‘‡

![](.gitbook/assets/image%20%2835%29.png)

è‡³æ­¤ï¼Œæˆ‘ä»¬åˆ†æå®Œäº†`Weak.init`çš„åº•å±‚æµç¨‹ï¼Œäºæ˜¯ä¿®æ”¹ä¹‹å‰çš„è°ƒç”¨ä»£ç ï¼ˆ`å»æ‰`äº†ä¹‹å‰çš„æ„Ÿå¹å·`!`ï¼‰ğŸ‘‡

```text
print(Weak.init(rawValue: "MON"))
print(Weak.init(rawValue: "Hello"))
```

ç¼–è¯‘å™¨ä¼šçˆ†å‡ºè­¦å‘Š\(`è¿”å›çš„ç»“æœæ˜¯å¯é€‰å‹`\)ï¼Œè¿è¡Œç»“æœğŸ‘‡

![](.gitbook/assets/image%20%2848%29.png)

æ‰€ä»¥ï¼Œç°åœ¨æˆ‘ä»¬å°±èƒ½æ˜ç™½ï¼Œä¸ºä»€ä¹ˆä¸€ä¸ªæ‰“å°çš„æ˜¯å¯é€‰å€¼ï¼Œä¸€ä¸ªæ‰“å°çš„æ˜¯nilã€‚

#### 2.3 æšä¸¾éå†ï¼šCaseIterableåè®®

`CaseIterableåè®®`ï¼Œæœ‰`allCases`å±æ€§ï¼Œæ”¯æŒ`éå†æ‰€æœ‰`caseï¼Œä¾‹å¦‚ğŸ‘‡  


```text
// Doubleç±»å‹
enum Week1: Double, CaseIterable {
    case Mon,Tue, Wed, Thu, Fri, Sat, Sun
}
Week1.allCases.forEach { print($0.rawValue)}

// Stringç±»å‹
enum Week2: String, CaseIterable {
    case Mon,Tue, Wed, Thu, Fri, Sat, Sun
}
Week2.allCases.forEach { print($0.rawValue)}
```

![](.gitbook/assets/image%20%2854%29.png)

#### 2.4 æšä¸¾å…³è”å€¼

`å…³è”å€¼`å°±æ˜¯ä¸Šé¢è®²è¿‡çš„`è‡ªå®šä¹‰ç±»å‹`çš„æšä¸¾ï¼Œå®ƒèƒ½è¡¨ç¤ºæ›´å¤æ‚çš„ä¿¡æ¯ï¼Œä¸æ™®é€šç±»å‹çš„æšä¸¾ä¸åŒç‚¹åœ¨äºğŸ‘‡

1. æ²¡æœ‰rawValue
2. æ²¡æœ‰rawValueçš„getteræ–¹æ³•
3. æ²¡æœ‰åˆå§‹åŒ–initæ–¹æ³•

ä¾‹å¦‚

```text
// è‡ªå®šä¹‰ç±»å‹çš„ä½¿ç”¨
enum Shape {
    case square(width: Double)
    case circle(radius: Double, borderWidth:Double)
}
```

æŸ¥çœ‹å…¶SILä»£ç ğŸ‘‡

![](.gitbook/assets/image%20%2831%29.png)

ä¸­é—´å±‚ä»£ç çœŸçš„ä»€ä¹ˆéƒ½æ²¡æœ‰ï¼ğŸ˜‚

#### 2.5 æ¨¡å¼åŒ¹é…

`æ¨¡å¼åŒ¹é…`å°±æ˜¯é’ˆå¯¹`caseçš„åŒ¹é…`ï¼Œæ ¹æ®æšä¸¾ç±»å‹ï¼Œåˆ†ä¸º2ç§ï¼š

1. ç®€å•ç±»å‹çš„æšä¸¾çš„æ¨¡å¼åŒ¹é…
2. è‡ªå®šä¹‰ç±»å‹çš„æšä¸¾ï¼ˆå…³è”å€¼ï¼‰çš„æ¨¡å¼åŒ¹é…

**2.5.1 ç®€å•ç±»å‹**

> swiftä¸­çš„ç®€å•ç±»å‹enumåŒ¹é…éœ€è¦å°†`æ‰€æœ‰æƒ…å†µéƒ½åˆ—ä¸¾`ï¼Œæˆ–è€…ä½¿ç”¨`defaultè¡¨ç¤ºé»˜è®¤æƒ…å†µ`ï¼Œå¦åˆ™ä¼š`æŠ¥é”™`ï¼

```text
enum Weak: String{
    case MON
    case TUE
    case WED
    case THU
    case FRI
    case SAT
    case SUN
}

var current: Weak?
switch current {
    case .MON:print(Weak.MON.rawValue)
    case .TUE:print(Weak.MON.rawValue)
    case .WED:print(Weak.MON.rawValue)
    default:print("unknow day")
}
```

å¦‚æœå»æ‰`default`ï¼Œä¼šæŠ¥é”™ğŸ‘‡

![](.gitbook/assets/image%20%2847%29.png)

æˆ‘ä»¬çœ‹çœ‹SILä»£ç ğŸ‘‡

![](.gitbook/assets/image%20%2851%29.png)

æ‰€ä»¥è¿è¡Œä¸Šé¢ä»£ç ï¼Œåº”è¯¥åŒ¹é…çš„æ˜¯defaultåˆ†æ”¯ğŸ‘‡

![](.gitbook/assets/image%20%2843%29.png)

**2.5.2 å…³è”å€¼ç±»å‹**

å…³è”å€¼ç±»å‹çš„æ¨¡å¼åŒ¹é…æœ‰ä¸¤ç§æ–¹å¼ğŸ‘‡

* switch - case ğŸ‘‰ åŒ¹é…æ‰€æœ‰case
* if - case ğŸ‘‰ åŒ¹é…å•ä¸ªcase

**switch - case**

```text
enum Shape{
    case circle(radius: Double)
    case rectangle(width: Int, height: Int)
}
```

`let`ä¿®é¥°`case`å€¼ğŸ‘‡



```text
let shape = Shape.circle(radius: 10.0)
switch shape{
    //ç›¸å½“äºå°†10.0èµ‹å€¼ç»™äº†å£°æ˜çš„radiuså¸¸é‡
    case let .circle(radius):
        print("circle radius: \(radius)")
    case let .rectangle(width, height):
        print("rectangle width: \(width) height: \(height)")
}
```

ä¹Ÿå¯ä»¥`let var`ä¿®é¥°`å…³è”å€¼çš„å…¥å‚`ğŸ‘‡



```text
let shape = Shape.circle(radius: 10.0)
switch shape{
    case .circle(let radius):
        print("circle radius: \(radius)")
    case .rectangle(let width, var height):
        height += 1
        print("rectangle width: \(width) height: \(height)")
}
```

æŸ¥çœ‹SILå±‚çš„ä»£ç ï¼Œçœ‹çœ‹æ˜¯æ€ä¹ˆåŒ¹é…çš„ğŸ‘‡

![](.gitbook/assets/image%20%2850%29.png)

**if - case**

```text
let circle = Shape.circle(radius: 10.0)
if case let Shape.circle(radius) = circle {
    print("circle radius: \(radius)")
}
```

**é€šç”¨å…³è”å€¼**

å¦‚æœåªå…³å¿ƒ`ä¸åŒcase`ä¸‹çš„`æŸä¸€ä¸ªå…³è”å€¼`ï¼Œå¯ä»¥å°†è¯¥å…³è”å€¼ç”¨`åŒä¸€ä¸ªå…¥å‚`æ›¿æ¢ï¼Œä¾‹å¦‚ä¸‹é¢ä¾‹å­ä¸­çš„`x`ğŸ‘‡



```text
enum Shape{
    case circle(radius: Double)
    case rectangle(width: Double, height: Double)
    case square(width: Double, height: Double)
}
let shape = Shape.circle(radius: 10)
switch shape{
case let .circle(x), let .square(20, x):
    print(x)
default:
    print("æœªåŒ¹é…")
    break
}
```

> æ³¨æ„ï¼šä¸èƒ½ä½¿ç”¨å¤šäº1ä¸ªçš„é€šç”¨å…¥å‚ï¼Œä¾‹å¦‚ä¸‹é¢çš„`y`ğŸ‘‡

![](.gitbook/assets/image%20%2830%29.png)

ä¹Ÿå¯ä»¥ä½¿ç”¨`é€šé…ç¬¦ _`ğŸ‘‡

```text
let shape = Shape.rectangle(width: 10, height:20)
switch shape{
case let .rectangle(_, x), let .square(_, x):
    print("x = \(x)")
default:
    break
}
```

è¿˜å¯ä»¥è¿™ä¹ˆå†™ğŸ‘‡

```text
let shape = Shape.rectangle(width: 10, height:20)
switch shape{
case let .rectangle(x, _), let .square(_, x):
    print("x = \(x)")
default:
    break
}
```

å¤§å®¶å¹³æ—¶åœ¨ä½¿ç”¨æšä¸¾æ—¶ï¼Œè¿˜æ˜¯è¦æ³¨æ„ä¸‹é¢2ç‚¹ğŸ‘‡

> 1. æšä¸¾ä½¿ç”¨è¿‡ç¨‹ä¸­ä¸å…³å¿ƒæŸä¸€ä¸ªå…³è”å€¼ï¼Œå¯ä»¥ä½¿ç”¨`é€šé…ç¬¦_`æ ‡è¯†
> 2. OCåªèƒ½è°ƒç”¨Swiftä¸­`Intç±»å‹`çš„æšä¸¾

#### 2.6 æ”¯æŒè®¡ç®—å‹å±æ€§ & å‡½æ•°

Swiftæšä¸¾ä¸­è¿˜æ”¯æŒ`è®¡ç®—å±æ€§`å’Œ`å‡½æ•°`ï¼Œä¾‹å¦‚ğŸ‘‡

```text
enum Direct: Int {
    case up
    case down
    case left
    case right
    
    // è®¡ç®—å‹å±æ€§
    var description: String{
        switch self {
        case .up:
            return "è¿™æ˜¯ä¸Šé¢"
        default:
            return "è¿™æ˜¯\(self)"
        }
    }
    
    // å‡½æ•°
    func printSelf() {
        print(description)
    }
}

Direct.down.printSelf() 
```

![](.gitbook/assets/image%20%2836%29.png)

### ä¸‰ã€æšä¸¾åµŒå¥—

æšä¸¾çš„åµŒå¥—ä¸»è¦æœ‰2ç§åœºæ™¯ğŸ‘‡

1. æšä¸¾åµŒå¥—æšä¸¾
2. ç»“æ„ä½“åµŒå¥—æšä¸¾

#### 3.1 enumåµŒå¥—enum

æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹`æšä¸¾åµŒå¥—æšä¸¾`ï¼Œæˆ‘ä»¬ç»§ç»­æ”¹ä¸‹ä¸Šé¢çš„ä¾‹å­ğŸ‘‡

```text
enum CombineDirect{
    //æšä¸¾ä¸­åµŒå¥—çš„æšä¸¾
    enum BaseDirect{
        case up
        case down
        case left
        case right
    }
    //é€šè¿‡å†…éƒ¨æšä¸¾ç»„åˆçš„æšä¸¾å€¼
    case leftUp(baseDirect1: BaseDirect, baseDirect2: BaseDirect)
    case leftDown(baseDirect1: BaseDirect, baseDirect2: BaseDirect)
    case rightUp(baseDirect1: BaseDirect, baseDirect2: BaseDirect)
    case rightDown(baseDirect1: BaseDirect, baseDirect2: BaseDirect)
}
```

å¦‚æœåˆå§‹åŒ–ä¸€ä¸ªå·¦ä¸Šæ–¹å‘ï¼Œä»£ç ğŸ‘‡

```text
let leftUp = CombineDirect.leftUp(baseDIrect1: CombineDirect.BaseDirect.left, baseDirect2: CombineDirect.BaseDirect.up)
```

#### 3.2 structåµŒå¥—enum

æ¥ä¸‹æ¥å°±æ˜¯`ç»“æ„ä½“åµŒå¥—æšä¸¾`äº†ï¼Œä¾‹å¦‚ğŸ‘‡

```text
//ç»“æ„ä½“åµŒå¥—æšä¸¾
struct Skill {
    enum KeyType{
        case up
        case down
        case left
        case right
    }
    
    let key: KeyType
    
    func launchSkill(){
        switch key {
        case .left, .right:
            print("left, right")
        case .up, .down:
            print("up, down")
        }
    }
}
```

#### 3.3 æšä¸¾çš„é€’å½’\(indirect\)

è¿˜æœ‰ä¸€ç§ç‰¹æ®Šçš„åœºæ™¯ `é€’å½’` ğŸ‘‰ æšä¸¾ä¸­`caseå…³è”å†…å®¹`ä½¿ç”¨è‡ªå·±çš„`æšä¸¾ç±»å‹`ã€‚ä¾‹å¦‚ğŸ‘‡

```text
enum Binary<T> {
    case empty
    case node(left: Binary, value:T, right:Binary)
}
```

ä¸€ä¸ª`æ ‘`ç»“æ„ï¼Œå…¶å·¦å³èŠ‚ç‚¹çš„ç±»å‹ä¹Ÿæ˜¯è‡ªå·±æœ¬èº«ï¼Œè¿™æ—¶ç¼–è¯‘å™¨ä¼šæŠ¥é”™ğŸ‘‡

![](.gitbook/assets/image%20%2853%29.png)

æŠ¥é”™åŸå›  ğŸ‘‰ ä½¿ç”¨è¯¥æšä¸¾æ—¶ï¼Œ`enumçš„å¤§å°`éœ€è¦`case`æ¥ç¡®å®šï¼Œè€Œcaseçš„å¤§å°åˆéœ€è¦ä½¿ç”¨åˆ°`enumå¤§å°`ã€‚æ‰€ä»¥`æ— æ³•è®¡ç®—`enmuçš„å¤§å°ï¼Œäºæ˜¯æŠ¥é”™ï¼  
å®‰æ’ ğŸ‘‰ æ ¹æ®ç¼–è¯‘å™¨æç¤ºï¼Œéœ€è¦ä½¿ç”¨å…³é”®å­—`indirect`ï¼Œæ„æ€å°±æ˜¯`å°†è¯¥æšä¸¾æ ‡è®°ä½é€’å½’`ï¼ŒåŒæ—¶`ä¹Ÿæ”¯æŒæ ‡è®°å•ä¸ªcase`ï¼Œæ‰€ä»¥å¯ä»¥ğŸ‘‡  
  


![](.gitbook/assets/image%20%2828%29.png)

é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œ`indirect`åœ¨åº•å±‚å¹²äº†ä»€ä¹ˆå‘¢ï¼Ÿ

**indirectåº•å±‚åŸç†**

æˆ‘ä»¬å…ˆæ¥çœ‹è¿™ä¸ªä¾‹å­ğŸ‘‡

```text
enum List<T>{
    case end
    indirect case node(T, next: List<T>)
}

var node = List<Int>.node(10, next: List<Int>.end)

print(MemoryLayout.size(ofValue: node))
print(MemoryLayout.stride(ofValue: node))
```

![](.gitbook/assets/image%20%2838%29.png)

sizeå’Œstrideéƒ½æ˜¯8ï¼Œæ¢æˆStringç±»å‹ğŸ‘‡

![](.gitbook/assets/image%20%2824%29.png)

ä»ç„¶ä¹Ÿæ˜¯8ï¼Œçœ‹æ¥æšä¸¾çš„å¤§å°ä¸å—å…¶æ¨¡æ¿ç±»å‹å¤§å°çš„å½±å“ã€‚

**lldbåˆ†æ**

æˆ‘ä»¬å…ˆlldbçœ‹çœ‹å…¶å†…å­˜çš„åˆ†å¸ƒğŸ‘‡

![](.gitbook/assets/image%20%2844%29.png)

ä¸Šå›¾ä¸­æˆ‘ä»¬å‘ç°ï¼Œnodeçš„`metadata`å¯¹åº”çš„åœ°å€`0x0000000100562660`æ˜¯åˆ†é…åœ¨`å †`ä¸Šçš„ï¼Œæ‰€ä»¥ï¼Œindirectå…³é”®å­—å…¶å®å°±æ˜¯é€šçŸ¥`ç¼–è¯‘å™¨`ï¼Œéœ€è¦åˆ†é…`ä¸€å—å †åŒº`çš„å†…å­˜ç©ºé—´ï¼Œç”¨æ¥å­˜æ”¾`enum` æˆ– `case`ã€‚æ­¤æ—¶caseä¸º`node`æ—¶ï¼Œå­˜å‚¨çš„æ˜¯`å¼•ç”¨åœ°å€0x0000000100562660`ï¼Œè€Œcaseä¸º`end`æ—¶ï¼Œåˆ™ğŸ‘‡  
  


![](.gitbook/assets/image%20%2829%29.png)

é‚£ä¸ºä½•è¯´åœ°å€æ˜¯å †åŒºå‘¢ï¼Ÿæˆ‘ä»¬æ¥ç€çœ‹çœ‹SILä»£ç ğŸ‘‡

![](.gitbook/assets/image%20%2859%29.png)

SILä»£ç ä¸­ï¼Œæ˜¯é€šè¿‡alloc\_boxç”³è¯·çš„å†…å­˜ï¼Œalloc\_boxåº•å±‚è°ƒç”¨çš„æ˜¯`swift_allocObject`ï¼Œæ‰€ä»¥æ˜¯å †åŒºï¼Œæˆ‘ä»¬å¯ä»¥å†nodeæ‰“ä¸Šæ–­ç‚¹ï¼ŒæŸ¥çœ‹æ±‡ç¼–ğŸ‘‡

![](.gitbook/assets/image%20%2839%29.png)

### å››ã€\#\#swiftå’ŒOCæ··ç¼–æšä¸¾

æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹çœ‹swiftå’ŒOCçš„æšä¸¾çš„æ··ç¼–åœºæ™¯ã€‚

#### 4.1 OCä½¿ç”¨Swiftæšä¸¾

é¦–å…ˆçœ‹çœ‹OCè°ƒç”¨Swiftæšä¸¾ï¼Œé‚£ä¹ˆæ­¤æ—¶æšä¸¾å¿…é¡»å…·å¤‡ä»¥ä¸‹2ä¸ªæ¡ä»¶ğŸ‘‡

1. ç”¨`@objc`å…³é”®å­—æ ‡è®°enum
2. å½“å‰enumå¿…é¡»æ˜¯`Intç±»å‹`

```text
// Swiftä¸­å®šä¹‰æšä¸¾
@objc enum Weak: Int{
    case MON, TUE, WED, THU, FRI, SAT, SUN
}

// OCä½¿ç”¨
- (void)test{
    Weak mon = WeakMON;
}
```

#### 4.2 Swiftä½¿ç”¨OCæšä¸¾

åè¿‡æ¥ï¼Œå°±æ²¡é™åˆ¶äº†ï¼ŒOCä¸­çš„æšä¸¾ä¼š`è‡ªåŠ¨è½¬æ¢`æˆswiftä¸­çš„enumã€‚

```text
// OCå®šä¹‰
NS_ENUM(NSInteger, OCENUM){
    Value1,
    Value2
};

// swiftä½¿ç”¨
//1ã€å°†OCå¤´æ–‡ä»¶å¯¼å…¥æ¡¥æ¥æ–‡ä»¶
#import "OCFile.h"
//2ã€ä½¿ç”¨
let ocEnum = OCENUM.Value1
```

**typedef enum**

```text
// OCå®šä¹‰
typedef enum {
    Num1,
    Num2
}OCNum;

// swiftä½¿ç”¨
let ocEnum = OCNum.init(0)
print(ocEnum)
```

![](.gitbook/assets/image%20%2825%29.png)

![](.gitbook/assets/image%20%2823%29.png)

ä¸Šå›¾å¯çŸ¥ï¼Œé€šè¿‡`typedef enum`å®šä¹‰çš„enumï¼Œåœ¨swiftä¸­å˜æˆäº†ä¸€ä¸ªç»“æ„ä½“ï¼Œå¹¶éµå¾ªäº†ä¸¤ä¸ªåè®®ï¼š`Equatable` å’Œ `RawRepresentable`ã€‚

**typedef NS\_ENUM**

```text
// OCå®šä¹‰
typedef NS_ENUM(NSInteger, OCNum) {
    Num1,
    Num2
};
// swiftä½¿ç”¨
let ocEnum = OCNum.init(rawValue: 0)
print(ocEnum!)
```

é‚£ä¹ˆè‡ªåŠ¨ç”Ÿæˆçš„swiftä¸­æ˜¯è¿™æ ·ğŸ‘‡

![](.gitbook/assets/image%20%2826%29.png)

å¹¶æ²¡æœ‰éµå¾ªä»»ä½•åè®®ï¼

#### 4.3 OCä½¿ç”¨Swiftä¸­Stringç±»å‹çš„æšä¸¾

è¿™ä¹Ÿæ˜¯ä¸€ç§å¸¸è§çš„åœºæ™¯ï¼Œè§£å†³æ–¹æ¡ˆğŸ‘‡

1. swiftä¸­çš„enumå°½é‡å£°æ˜æˆIntæ•´å‹
2. ç„¶åOCè°ƒç”¨æ—¶ï¼Œä½¿ç”¨çš„æ˜¯Intæ•´å‹çš„
3. enumå†å£°æ˜ä¸€ä¸ª`å˜é‡/æ–¹æ³•`ï¼Œç”¨äº`è¿”å›å›ºå®šçš„å­—ç¬¦ä¸²`ï¼Œç»™swiftä¸­ä½¿ç”¨ ç¤ºä¾‹ğŸ‘‡



```text
@objc enum Weak: Int{
    case MON, TUE, WED
    
    var val: String?{
        switch self {
        case .MON:
            return "MON"
        case .TUE:
            return "TUE"
        case .WED:
            return "WED"
        default:
            return nil
        }
    }
}

// OCä¸­ä½¿ç”¨
Weak mon = WeakMON;

// swiftä¸­ä½¿ç”¨
let weak = Weak.MON.val
```

### äº”ã€æšä¸¾çš„å¤§å°

ä¸»è¦åˆ†æä»¥ä¸‹å‡ ç§æƒ…å†µğŸ‘‡

1. æ™®é€šenum
2. å…·æœ‰å…³è”å€¼çš„enum
3. enumåµŒå¥—enum
4. structåµŒå¥—enum

æšä¸¾çš„å¤§å°ä¹Ÿæ˜¯é¢è¯•ä¸­ç»å¸¸é—®åˆ°çš„é—®é¢˜ï¼Œé‡ç‚¹åœ¨äºä¸¤ä¸ªå‡½æ•°çš„åŒºåˆ«ğŸ‘‡

`size`: `å®é™…å ç”¨`å†…å­˜å¤§å°  
`stride`:`ç³»ç»Ÿåˆ†é…`çš„å†…å­˜å¤§å°

#### 5.1 æ™®é€šenum

æœ€æ™®é€šçš„æƒ…å†µï¼Œå³`éåµŒå¥—ï¼Œéè‡ªå®šä¹‰ç±»å‹`çš„æšä¸¾ï¼Œä¾‹å¦‚ğŸ‘‡

```text
enum Weak {
    case MON
}

print(MemoryLayout<Weak>.size)
print(MemoryLayout<Weak>.stride)
```



